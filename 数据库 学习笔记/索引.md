索引是一种排序的数据结构，通常使用B树和B+树，相当于目录，方便内容的查找，本身也占用物理空间。

## 索引的优缺点

优点：
- 唯一性
- 加快检索速度（主要）
- 加速表和表之间的连接，实现数据的参考完整性
- 使用优化隐藏器提高系统性能

缺点：
- 对表中数据进行增删改的时候需要维护索引，导致额外开销
- 需要占物理空间，如果建立聚簇索引则更大

## 索引的数据结构

B树索引，哈希索引，位图索引

### B树索引（平衡树索引）
一棵 m 阶 B-Tree 的特性如下：

- 每个结点最多 m 个子结点；
- 除了根结点和叶子结点外，每个结点最少有 m/2（向上取整）个子结点；
- 所有的叶子结点都位于同一层；
- 每个结点都包含 k 个元素（关键字），这里 m/2≤k<m，这里 m/2 向下取整；
- 每个节点中的元素（关键字）从小到大排列；
- 每个元素子左结点的值，都小于或等于该元素，右结点的值都大于或等于该元素。
![B树.png](https://pic.leetcode-cn.com/1629446588-fpMLVA-B%E6%A0%91.png)

B+树的特性：
-   所有的非叶子结点只存储 **关键字信息**；
-   所有具体数据都存在叶子结点中；
-   所有的叶子结点中包含了全部元素的信息；
-   所有叶子节点之间都有一个链指针。
![B_ Tree.png](https://pic.leetcode-cn.com/1629448733-VWjqZc-B_%20Tree.png)

### Hash索引

把数据库字段转换为定长哈希值，检索时直接$O(1)$查询。只适用于等值查询，不能用于范围查询或者模糊查询。

### 位图索引

适合处理静态的、包含的列基数较小的数据。

比如一列只有三种值，那么对这三种值分别定义3个位图，即3个向量，然后就可以用这3个向量来确定每一列的取值。

## B+树的优点

- 可以存放更多键，更快缩小查找范围
- 由于叶节点是链表，且数据都在叶节点上，所以可以稳定$O(log n)$找到叶子结点，然后$O(n)$遍历链表，同时有利于范围查询。

## 前缀索引

通过截取键的一部分前缀来生成索引，来减小索引需要的空间和提高性能，但索引的选择性也会降低。索引选择性是不重复的索引值和表中所有行数的比值，范围在$[\frac{1}{t},1]$。

## 最左前缀匹配原则

建立**联合索引（多列索引）** 时遵循最左前缀匹配原则，即**最左优先**，从联合索引的最左边开始匹配。例如有一个 3 列索引（a,b,c），则已经对（a）、（a,b）、（a,b,c）上建立了索引。所以在创建 多列索引时，要根据业务需求，where 子句中 **使用最频繁** 的一列放在最左边。

根据最左前缀匹配原则，MySQL 会一直向右匹配直到遇到 范围查询（>、<、between、like）就停止匹配，比如采用查询条件 where a = 1 and b = 2 and c > 3 and d = 4 时，如果建立（a,b,c,d）顺序的索引，d 是用不到索引的，如果建立（a,b,d,c）的索引则都可以用到，并且 where 子句中 a、b、d 的顺序可以任意调整。

如果建立的索引顺序是 （a,b） ，那么根据最左前缀匹配原则，直接采用查询条件 where b = 1 是无法利用到索引的。

## 添加索引的原则

- 很少查询的列不要创建索引
- 只有很少数据值的列不要创建索引
- `text`,`image`,`bit`类型的列不要创建索引
- 修改性能远大于检索性能时不要创建索引
- 定义有**外键**的数据列一定要创建索引。

## 聚簇索引（聚集索引）

聚簇索引不是一种索引类型，而是一种数据存储方式。指将 **数据存储** 和 **索引** 放在一起。

MySQL中只有InnoDB表支持聚簇索引，对InnoDB表进行全表扫描会非常快。

### 特点

- 有更高的检索效率
- 减少磁盘IO次数
- 一个数据表只能有一个聚簇索引
- 一般在频繁使用、排序的字段上创建聚簇索引。

### 非聚簇索引

除了聚簇索引都叫非聚簇索引。非聚簇索引也是B树结构，不存储真正的数据行，只包含一个指向数据行的指针。

### 概括

聚簇索引叶节点存数据本身，非聚簇索引存数据地址。根据这个不难想到他们的一些特点：
- 聚簇索引的更新代价很高，因为要移动所有行的位置
- 当行的主列值必须插入到某个已满的页中，存储引擎会将该页分裂为两个页面来容纳该行，导致“页分裂”的问题，占用更多的磁盘空间。