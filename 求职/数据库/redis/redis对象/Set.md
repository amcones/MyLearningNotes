是一个不重复、无序的字符串集合。适用于无序集合场景，比如哪些用户关注了某个公众号，还能用交并补实现共同关注的功能。

## 命令

### 写

1. SADD
添加元素，返回添加元素个数
2. SREM
删除元素，返回删除元素个数

### 读

1. SISMEMBER
查询元素是否存在
2. SCARD
查询集合元素个数
3. SMEMBERS
查看集合的所有元素
4. SSCAN
查看集合元素，指定游标进行查询，可以指定个数，默认10个
5. SINTER
求交
6. SUNION
求并
7. SDIFF
求补，是第一个集合和后面比多了哪些元素。

## 底层实现

### 编码方式

1. INTSET
元素都是整数，且元素数量不超过512个就可以用，排列紧凑内存少，查询用二分（底层有序）。
2. HASHTABLE
哈希表，$O(1)$查询。
dictht结构：
- table：指向实际存储的指针，一个数组
- size：大小
- sizemask：始终等于size-1，与哈希值取&后决定放在hash哪个索引上
- used：表示已经使用的节点数量

redis没有直接把dictht暴露给外层，而是封装了两个dictht结构，用于实现渐进式扩容。扩容时，首先生成新的哈希表，然后随着rehash进行，每次CRUD的时候顺带迁移一个数据并更新偏移索引（已经迁移了多少，用于定位该从哪里操作数据），同时一些周期函数（serverCron）也会进行迁移。

扩容时机：
1. 负载因子大于等于1
2. 负载因子大于等于5，此时即使有复制命令在进行，也要进行Rehash扩容。

缩容类似扩容：
1. 当负载因子小于0.1，缩容，新表大小为第一个大于等于原表used的2次方幂。